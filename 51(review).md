# 一.对51单片机相关知识复习

## 1.单片机八大功能部件（单总线）

+ 微处理器（8位CPU）

+ 程序存储器（ROM）

+ 数据存储器（RAM）

+ 4个8位并行可编程I/O端口（P0，P1，P2，P3）

+ 一个串行接口（UART）（全双工）

+ 两个16位定时器/计数器（T0，T1）

+ 中断系统（5个中断源，其中，外部中断源2个，内部中断源2个，串行中断源一个）

+ 特殊功能寄存器（SFR）

## 2.位相关操作

+ &:与  与符号两侧只要有0，结果为0，否则为1

+ |:或  或两侧只要有1，结果为1，否则为0

+ ~:非  按位取反，~0=1，~1=0

+ ^:异或  相同为0，不同为1

## 3.单片机系统相关知识

+ 最基本的三大电路：电源电路，时钟电路，复位电路

+ 周期：时钟晶体的振荡频率为fosc，则时钟周期Tosc = 1 / fosc，12个时钟周期为一个系统周期，Tcy = 12 / fosc

+ 复位：给RST加上大于两个机器周期的高电平就可以实现复位

## 4.MSC-51存储器结构

+ 物理空间有四个部分
    1.内部数据存储器（128B)。
    2.外部扩展数据存储器（最大64K RAM）。
    3.内部程序存储器（4K ROM）
    4.外部扩展程序存储器（最大64KRAM)。
+ 逻辑空间有三个部分
    1.程序存储器ROM：包括内部和外部，共用一个64K的寻址空间。
    2.内部数据存储器RAM（128B），独立的一个128B的寻址空间。
    3.外部数据存储器RAM（64K），独立的一个64K的寻址空间。

+ 注意：内部数据存储器和外部数据存储器相互之间独立编址，内部程序存储器和外部程序存储器统一编址，共用一个64K的寻址空间。

## 5.引脚

+ 电源引脚：
    1.Vcc（40脚）：+5V电源；
    2.Vss（20脚）：接地。

+ 时钟引脚：
    1.XTAL1（19脚）：如果采用外接晶体振荡器时，此引脚应接地。
    2.XTAL2 （18脚）：接外部晶体的另一端。

+ 控制引脚功能：提供控制信号，有的引脚还具有复用功能。
    1.RST/VPD(9脚)
    2.ALE/PROG*（30脚）端可以驱动8个LS型TTL 负载。PROG*为本引脚的第二功能。为编程脉冲输入端。
    3.PSEN* （29脚）读外部程序存储器的选通信号，可以驱动8个LS型TTL负载。
    4.EA*/VPP (Enable Address/Voltage Pulse of Programing，31脚)
    EA* 为内外程序存储器选择控制端。EA* =1，单片机访问片内程序存储器，但在PC（程序计数器）值超过0FFFH（对于8051、8751）时，即超出片内程序存储器的4K字节地址范围时，将自动转向执行外部程序存储器内的程序。EA*=0，单片机则只访问外部程序存储器。VPP为本引脚的第二功能。用于施加较高的编程电压（例如+21V或+12V）。对于C51，则加在VPP脚的编程电压为+12V或+5V。

+ I/O口引脚
    1.P0口：双向8位三态I/O口，此口为地址总线（低8位）及数据总线分时复用口，可驱动8个LS型TTL负载。
    2.P1口：8位准双向I/O口，可驱动4个LS型TTL负载。
    3.P2口：8位准双向I/O口，与地址总线（高8位）复用，可驱动4个LS型TTL负载。
    4.P3口：8位准双向I/O口，双功能复用口，可驱动4个LS型TTL负载。
    5.P3口的第二功能：

    ```C
    sbit RD    = P3^7;      //外部数据存储器读选通
    sbit WR    = P3^6;      //外部数据存储器写选通
    sbit T1    = P3^5;      //定时器1外部计数输入
    sbit T0    = P3^4;      //定时器2外部计数输入
    sbit INT1  = P3^3;      //外部中断1
    sbit INT0  = P3^2;      //外部中断0
    sbit TXD   = P3^1;      //串行输出口
    sbit RXD   = P3^0;      //串行输入口
    ```

## 6.矩阵键盘检测

+ 逐行扫描法

+ 线反转法（列线为低八位，行线为高八位）

## 7.中断

+ 中断允许控制IE：
    EX0(IE.0)，外部中断0允许位；
    ET0(IE.1)，定时/计数器T0中断允许位；
    EX1(IE.2)，外部中断0允许位；
    ET1(IE.3)，定时/计数器T1中断允许位；
    ES（IE.4)，串行口中断允许位；
    ET2(IE.5)，定时/计数器T2中断允许位；
    EA (IE.7)， CPU中断允许（总允许）位。

+ 中断优先级控制IP（使用较少）：
    PS=1/0:串行口中断定义为高级/低级优先级中断
    PT0=1/0：定时器/计数器0定义为高级/低级优先级中断
    PT1=1/0：定时器/计数器1定义为高级/低级优先级中断
    PT2=1/0：定时器/计数器2定义为高级/低级优先级中断
    PX0=1/0: 外部中断0定义为高级/低级优先级中断
    PX1=1/0: 外部中断1定义为高级/低级优先级中断

+ 中断请求标志及外部中断方式选择寄存器：
    IT0（TCON.0），外部中断0触发方式控制位。
    **当IT0=0时，为电平触发方式。**
    **当IT0=1时，为边沿触发方式（下降沿有效）。**
    IE0(TCON.1),外部中断0中断请求标志位。
    IT1(TCON.2),外部中断1触发方式控制位。
    IE1(TCON.3),外部中断1中断请求标志位。
    TF0(TCON.5),定时/计数器T0溢出中断请求标志位。
    TF1(TCON.7),定时/计数器T1溢出中断请求标志位。

## 8.定时计数器

+ 8051单片机片内有二个十六位定时器／计数器：定时器0(T0)和定时器1(T1)。
    2个16位定时器实际上都是16位加1计数器。T0由2个8位特殊功能寄存器TH0和TL0构成，T1由TH1和TL1构成。
    每个定时器都可由软件设置为定时工作方式或计数工作方式。
    这些功能都由特殊功能寄存器TMOD设置和TCON所控制。

+ 定时器/计数器初始化步骤：
    1.确定工作方式：把工作方式控制字写入到TMOD中；（TMOD低四位为定时/计数器0，高四位为定时/计数器1）（00:方式0；01：方式1；10：方式2；11:方式3）
    2.设置定时或计数的初值：根据问题要求，求出定时或计数的初值，写入到寄存器TH0、TL0或TH1、TL1中。
    3.如果需要中断，使定时器中断允许位ET0或ET1置位，如果要求中断嵌套，还应设置相应的中断优先级，然后置位EA，使CPU开放中断；如果不需要中断，仅以软件方式对计数器溢出标志TF0或TF1进行查询，则可略去此步骤；
    4.启动定时器／计数器：将 TR0或 TR1置 1即可启动定时器／计数器。

+ 定时器的四种工作方式：
    1.方式0：13位计数，TL0的低五位，TH0的高八位，TL0的低五位溢出时，向TH0进位，TH0溢出时，置位TCON的TF0标志，发出中断请求
    2.方式1的计数位数是16位，由TL0作为低8位、TH0作为高8位，组成了16位加1计数器。
    3.方式2为自动重装初值的8位计数方式。（工作方式2特别适合于用作较精确的脉冲信号发生器）
    4.方式3只适用于定时/计数器T0，定时器T1处于方式3时相当于TR1=0，停止计数。工作方式3将T0分成为两个独立的8位计数器TL0和TH0 。
